<!DOCTYPE html>
<html>
<head>
    <title>Academy UI Debug</title>
</head>
<body>
    <h1>Academy UI Debug Test</h1>
    
    <!-- Simulate the exact DOM structure from the main UI -->
    <div id="academy-active-count">0</div>
    <div id="academy-graduated-count">0</div>
    <div id="academy-training-list">Loading...</div>
    
    <button onclick="testUpdate()">Test Academy Update</button>
    <button onclick="checkElements()">Check DOM Elements</button>
    
    <div id="debug-output"></div>

    <script>
        function log(message) {
            const output = document.getElementById('debug-output');
            output.innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }
        
        function checkElements() {
            log('=== DOM Element Check ===');
            const activeCount = document.getElementById('academy-active-count');
            const graduatedCount = document.getElementById('academy-graduated-count');
            const trainingList = document.getElementById('academy-training-list');
            
            log('activeCount element exists: ' + !!activeCount);
            log('graduatedCount element exists: ' + !!graduatedCount);
            log('trainingList element exists: ' + !!trainingList);
            
            if (activeCount) log('activeCount current value: "' + activeCount.textContent + '"');
            if (graduatedCount) log('graduatedCount current value: "' + graduatedCount.textContent + '"');
            if (trainingList) log('trainingList current value: "' + trainingList.innerHTML + '"');
        }
        
        function testUpdate() {
            log('=== Testing Academy Update ===');
            
            // Simulate the exact data structure from the backend
            const mockData = {
                type: 'academy_status',
                status: {
                    activeTraining: [{
                        personaName: 'PlannerAI-enhanced-1748940671818',
                        status: 'training_round_3',
                        progress: 20,
                        currentRound: 3,
                        totalRounds: 15,
                        graduationScore: 0.65,
                        specialization: 'ai_recommended_enhancement'
                    }],
                    completed: [],
                    stats: {
                        totalPersonas: 1,
                        activeTraining: 1,
                        graduated: 0,
                        failed: 0
                    }
                }
            };
            
            updateAcademySection(mockData);
        }
        
        // Copy the exact functions from the main UI
        let lastAcademyUpdate = 0;
        function updateAcademySection(data) {
            // Throttle Academy updates to once per 3 seconds
            const now = Date.now();
            if (now - lastAcademyUpdate < 3000) {
                log('üéì Frontend: Academy update throttled');
                return;
            }
            lastAcademyUpdate = now;
            
            log('üéì Frontend: updateAcademySection called');
            // Handle nested status object
            const status = data.status || data;
            const { activeTraining = [], completed = [] } = status;
            log('üéì Frontend: Active training: ' + activeTraining.length + ' Completed: ' + completed.length);
            
            // Update Academy sidebar training list
            updateAcademySidebar(activeTraining, completed);
        }
        
        function updateAcademySidebar(activeTraining, completed) {
            log('üéì Frontend: updateAcademySidebar called with: ' + activeTraining.length + ' active, ' + completed.length + ' completed');
            
            // Update Academy training list in sidebar
            const trainingList = document.getElementById('academy-training-list');
            if (trainingList) {
                log('üéì Training list element found');
                if (activeTraining.length === 0) {
                    trainingList.innerHTML = '<div class="loading">No active training sessions</div>';
                    log('üéì Set training list to: No active sessions');
                } else {
                    const html = activeTraining.map(session => 
                        '<div>Training: ' + session.personaName + ' (' + session.progress + '%)</div>'
                    ).join('');
                    trainingList.innerHTML = html;
                    log('üéì Set training list to: ' + html);
                }
            } else {
                log('üéì ‚ùå Training list element NOT found');
            }
            
            // Update Academy statistics
            const activeCount = document.getElementById('academy-active-count');
            const graduatedCount = document.getElementById('academy-graduated-count');
            
            log('üéì Frontend: Updating stats - activeCount element: ' + !!activeCount + ' graduatedCount element: ' + !!graduatedCount);
            
            if (activeCount) {
                const newValue = activeTraining.length;
                activeCount.textContent = newValue;
                log('üéì Frontend: Set active count to: ' + newValue);
                log('üéì Frontend: Active count now reads: "' + activeCount.textContent + '"');
            } else {
                log('üéì ‚ùå Active count element NOT found');
            }
            
            if (graduatedCount) {
                const newValue = completed.filter(c => c.status === 'graduated').length;
                graduatedCount.textContent = newValue;
                log('üéì Frontend: Set graduated count to: ' + newValue);
                log('üéì Frontend: Graduated count now reads: "' + graduatedCount.textContent + '"');
            } else {
                log('üéì ‚ùå Graduated count element NOT found');
            }
        }
        
        // Auto-check elements on load
        setTimeout(checkElements, 100);
    </script>
</body>
</html>