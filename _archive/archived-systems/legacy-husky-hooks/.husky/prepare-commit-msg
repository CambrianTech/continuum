#!/usr/bin/env sh
# CONTINUUM PREPARE-COMMIT-MSG HOOK: Append System Health Scorecard

# The commit message file is passed as the first argument
COMMIT_MSG_FILE="$1"

printf "üîç Adding system health scorecard to commit message...\n"

# Generate concise scorecard for commit message
SCORECARD_TEXT=$(npx tsx src/testing/generate-system-scorecard.ts 2>/dev/null)

if [ $? -eq 0 ] && [ -n "$SCORECARD_TEXT" ]; then
    # Append scorecard to commit message
    echo "$SCORECARD_TEXT" >> "$COMMIT_MSG_FILE"
    printf "‚úÖ System health scorecard appended to commit message\n"
else
    printf "‚ö†Ô∏è Failed to generate scorecard - commit message unchanged\n"
fi