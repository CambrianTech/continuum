#!/usr/bin/env sh
# CONTINUUM COMMIT-MSG HOOK: Append System Health Scorecard

# The commit message file is passed as the first argument
COMMIT_MSG_FILE="$1"

# Check if we have a pending scorecard from pre-commit hook
if [ -f ".git/SCORECARD_PENDING" ]; then
    # Read the pending scorecard
    SCORECARD_TEXT=$(cat .git/SCORECARD_PENDING)
    
    # Append to commit message
    echo "$SCORECARD_TEXT" >> "$COMMIT_MSG_FILE"
    
    # Clean up pending file
    rm -f .git/SCORECARD_PENDING
    
    printf "✅ System health scorecard appended to commit message via commit-msg hook\n"
else
    # Generate scorecard directly if no pending one
    SCORECARD_TEXT=$(npx tsx src/testing/generate-system-scorecard.ts 2>/dev/null)
    
    if [ $? -eq 0 ] && [ -n "$SCORECARD_TEXT" ]; then
        echo "$SCORECARD_TEXT" >> "$COMMIT_MSG_FILE"
        printf "✅ System health scorecard appended to commit message\n"
    fi
fi