<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px;
            background: #1a1f2e;
            color: #e0e6ed;
        }
        
        .test-container {
            border: 1px solid #333;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        
        h2 {
            color: #64b5f6;
            margin-top: 0;
        }
        
        .widget-test {
            min-height: 200px;
            border: 1px solid #444;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        .success { background: #2d5a27; color: #81c784; }
        .error { background: #5d2d2d; color: #e57373; }
        .warning { background: #5d4e2d; color: #ffb74d; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Widget Loading Test</h1>
    
    <div class="test-container">
        <h2>Direct Widget Loading Test</h2>
        <div id="test-results"></div>
        
        <h3>Chat Widget Test:</h3>
        <chat-widget class="widget-test"></chat-widget>
        
        <h3>Sidebar Widget Test:</h3>
        <continuum-sidebar class="widget-test"></continuum-sidebar>
        
        <h3>Manual Widget Loading:</h3>
        <button id="load-widgets">Load Widgets Manually</button>
        <div id="manual-results"></div>
    </div>
    
    <script>
        window.__CONTINUUM_VERSION__ = '0.2.2243';
        
        function addResult(container, test, status, message) {
            const div = document.createElement('div');
            div.className = `status ${status}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            container.appendChild(div);
        }
        
        function testWidgets() {
            const results = document.getElementById('test-results');
            
            // Test custom element definitions
            addResult(results, 'chat-widget defined', 
                customElements.get('chat-widget') ? 'success' : 'error',
                customElements.get('chat-widget') ? 'Yes' : 'No'
            );
            
            addResult(results, 'continuum-sidebar defined', 
                customElements.get('continuum-sidebar') ? 'success' : 'error',
                customElements.get('continuum-sidebar') ? 'Yes' : 'No'
            );
            
            // Check widget instances
            setTimeout(() => {
                const chatWidget = document.querySelector('chat-widget');
                const sidebarWidget = document.querySelector('continuum-sidebar');
                
                addResult(results, 'ChatWidget instance', 
                    chatWidget && chatWidget.tagName ? 'success' : 'error',
                    chatWidget ? `Found: ${chatWidget.tagName}` : 'Not found'
                );
                
                addResult(results, 'SidebarWidget instance', 
                    sidebarWidget && sidebarWidget.tagName ? 'success' : 'error',
                    sidebarWidget ? `Found: ${sidebarWidget.tagName}` : 'Not found'
                );
            }, 1000);
        }
        
        // Manual widget loading
        document.getElementById('load-widgets').addEventListener('click', async () => {
            const manualResults = document.getElementById('manual-results');
            manualResults.innerHTML = '';
            
            try {
                console.log('ðŸ” Attempting to load ChatWidget...');
                addResult(manualResults, 'Loading ChatWidget', 'warning', 'Starting...');
                await import('/dist/ui/components/Chat/ChatWidget.js');
                addResult(manualResults, 'ChatWidget import', 'success', 'Loaded successfully');
            } catch (error) {
                addResult(manualResults, 'ChatWidget import', 'error', error.message);
                console.error('ChatWidget load failed:', error);
            }
            
            try {
                console.log('ðŸ” Attempting to load SidebarWidget...');
                addResult(manualResults, 'Loading SidebarWidget', 'warning', 'Starting...');
                await import('/dist/ui/components/Sidebar/SidebarWidget.js');
                addResult(manualResults, 'SidebarWidget import', 'success', 'Loaded successfully');
            } catch (error) {
                addResult(manualResults, 'SidebarWidget import', 'error', error.message);
                console.error('SidebarWidget load failed:', error);
            }
            
            // Re-test after manual loading
            setTimeout(() => {
                testWidgets();
            }, 500);
        });
        
        // Initial test
        testWidgets();
    </script>
</body>
</html>