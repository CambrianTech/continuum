# TerminalWidget

tmux-like terminal multiplexer showing AI shell sessions and live process output

## Table of Contents

- [Overview](#overview)
- [Structure](#structure)
- [Usage](#usage)
  - [Navigation](#navigation)
  - [Recipe Configuration](#recipe-configuration)
- [Positron Context](#positron-context)
- [Styling](#styling)
- [Customization](#customization)
- [Testing](#testing)
- [AI Experimentation](#ai-experimentation)

## Overview

**Display Name:** Terminal
**Tag Name:** `<terminal-widget>`
**Path Prefix:** `/terminal`
**Requires Entity:** No

## Structure

```
widgets/terminal/
├── TerminalWidget.ts        # Widget logic
├── public/
│   ├── terminal-widget.html  # Template
│   ├── terminal-widget.scss  # Styles (source)
│   ├── terminal-widget.css   # Compiled CSS
│   └── terminal-widget.styles.ts  # CSS as TS export
└── README.md                        # This file
```

## Usage

### Navigation

**CLI:**
```bash
./jtag interface/navigate --path="/terminal"
```

**Programmatic:**
```typescript
import { Commands } from '@system/core/shared/Commands';

await Commands.execute('interface/navigate', {
  path: '/terminal'
});
```

**Recipe:**
```typescript
await Commands.execute('workspace/recipe/load', {
  recipeId: 'terminal'
});
```

### Recipe Configuration

This widget's behavior is configured via recipe at `system/recipes/terminal.json`:

```json
{
  "uniqueId": "terminal",
  "name": "Terminal",
  "layout": {
    "main": ["terminal-widget"],
    "right": {
        "widgets": [
            "chat-widget"
        ],
        "config": {
            "room": "help",
            "compact": true
        }
    }
  }
}
```

## Positron Context

This widget emits context to Positron for AI awareness:

```typescript
PositronWidgetState.emit({
  widgetType: 'terminal',
  title: 'Terminal',
  metadata: { /* widget-specific data */ }
}, {
  action: 'viewing',
  target: 'terminal'
});
```

AIs in the right panel automatically receive this context, enabling contextual help.

## Styling

Styles use shared SCSS variables from `widgets/shared/styles/_variables.scss`:

```scss
@import '../../shared/styles/variables';
@import '../../shared/styles/mixins';

:host {
  display: block;
  width: 100%;
  height: 100%;
}

.terminal-container {
  background: $bg-panel;
  color: $color-text;
}
```

**Compile SCSS:**
```bash
npx tsx scripts/compile-sass.ts
```

This generates both:
- `.css` file (for HTTP fetch loading)
- `.styles.ts` file (for TypeScript imports)

## Customization

### Adding Interactivity

1. Add elements to `public/terminal-widget.html`
2. Add event listeners in `setupEventListeners()`:

```typescript
private setupEventListeners(): void {
  const button = this.shadowRoot?.querySelector('#my-button');
  button?.addEventListener('click', () => this.handleClick());
}
```

### Fetching Data

```typescript
protected async onWidgetInitialize(): Promise<void> {
  const result = await this.executeCommand('data/list', {
    collection: 'my-collection'
  });
  // Use result.items
}
```

### Emitting Events

```typescript
this.dispatchEvent(new CustomEvent('terminal-action', {
  detail: { action: 'something' },
  bubbles: true
}));
```

## Testing

### Visual Verification

```bash
npm start  # Deploy changes
./jtag interface/navigate --path="/terminal"
./jtag interface/screenshot
```

### AI QA Testing

Ask the AI team to test your widget:

```bash
./jtag collaboration/chat/send --room="general" \
  --message="I just updated Terminal. Can you navigate there and let me know if it looks right?"

# Wait 30 seconds, then check responses
./jtag collaboration/chat/export --room="general" --limit=20
```

## AI Experimentation

This widget follows the modular pattern enabling safe AI experimentation:

1. **Isolation**: Widget runs in shadow DOM, can't break other widgets
2. **Hot reload**: Changes visible after `npm start` (90s)
3. **Rollback**: Git revert if experiment fails
4. **Graduation**: Successful experiments become permanent via commit

**Experiment workflow:**
```bash
# 1. AI modifies widget files
# 2. Deploy: npm start
# 3. Test: ./jtag interface/screenshot
# 4. If good: git add && git commit
# 5. If bad: git checkout -- widgets/terminal/
```

---

*Generated by WidgetGenerator*
