/**
 * Academy Chat Room Types - Training Sessions as Specialized Chat Rooms
 * =====================================================================
 * 
 * Academy sessions are specialized chat rooms within the Continuum chat system.
 * They work like regular Discord channels but with enhanced training features:
 * 
 * - Academy sessions are chat rooms with training objectives
 * - All chat features work normally (messages, media, reactions)
 * - Additional Academy features overlay on top (capability tracking, evolution)
 * - Citizens can join/leave like any chat room
 * - Training happens through natural conversation
 * - Evolution and learning are invisible to non-participants
 * 
 * Architecture:
 * - Extends regular ChatRoom with Academy-specific features
 * - Academy features are optional overlays, not replacements
 * - Same citizen equality - everyone participates the same way
 * - Training data flows from normal chat interactions
 */

import { ChatRoom, RoomCitizenship, UniversalChatMessage, ChatCitizen } from './UniversalCitizenTypes';

// ========================
// Academy Chat Room Extension
// ========================

export interface AcademyChatRoom extends ChatRoom {
  roomType: 'academy_training';
  
  // Academy session info
  academySessionId: string;
  sessionName: string;
  trainingObjectives: TrainingObjective[];
  
  // Session state
  sessionStatus: 'preparing' | 'active' | 'paused' | 'completed' | 'cancelled';
  sessionStartTime?: number;
  estimatedDuration: number;      // milliseconds
  actualDuration?: number;
  
  // Training configuration
  trainingMode: 'collaborative' | 'competitive' | 'socratic' | 'demonstration' | 'free_form';
  difficultyLevel: 'beginner' | 'intermediate' | 'advanced' | 'expert' | 'adaptive';
  
  // Specialized roles (overlaid on regular chat room)
  trainingRoles: Map<string, TrainingRole>;
  
  // Academy features (invisible to non-participants)
  academyFeatures: AcademyFeatures;
  
  // Session artifacts
  knowledgeCreated: KnowledgeArtifact[];
  capabilityEvolutions: CapabilityEvolution[];
  trainingInsights: TrainingInsight[];
  
  // Public visibility
  publiclyVisible: boolean;       // Can non-participants see this room
  allowObservers: boolean;        // Can citizens join as observers
  inviteOnly: boolean;           // Requires invitation to join
}

export interface TrainingObjective {
  objectiveId: string;
  description: string;
  
  // Objective details
  targetSkill: string;
  currentLevel: 'none' | 'basic' | 'intermediate' | 'advanced' | 'expert';
  targetLevel: 'basic' | 'intermediate' | 'advanced' | 'expert' | 'mastery';
  
  // Success criteria
  measurable: boolean;
  successCriteria: string[];
  assessmentMethod: 'conversation' | 'demonstration' | 'peer_review' | 'automatic';
  
  // Progress tracking
  progress: number;               // 0-1 completion
  milestones: ObjectiveMilestone[];
  
  // Participants involved
  primaryLearners: string[];      // Citizens trying to achieve this objective
  supporters: string[];          // Citizens helping with this objective
  assessors: string[];           // Citizens who can assess progress
}

export interface TrainingRole {
  citizenId: string;
  role: 'teacher' | 'student' | 'peer_learner' | 'mentor' | 'observer' | 'facilitator' | 'challenger';
  
  // Role characteristics
  expertise: string[];            // Areas of expertise (for teachers/mentors)
  learningGoals: string[];        // What they want to learn (for students)
  contributionType: string[];     // How they contribute to the session
  
  // Role assignment
  selfAssigned: boolean;          // Did they choose this role
  communityAssigned: boolean;     // Did community assign this role
  systemSuggested: boolean;       // Did system suggest this role
  
  // Role performance
  roleEffectiveness: number;      // 0-1 how effectively they fulfill role
  contributionQuality: number;    // 0-1 quality of their contributions
  learningProgress: number;       // 0-1 their learning progress (if learner)
  
  // Role evolution
  roleChanges: RoleChange[];      // How their role has evolved
  futureRoles: string[];          // Roles they might grow into
}

export interface AcademyFeatures {
  // Core Academy features
  capabilityTracking: boolean;    // Track capabilities used in chat
  performanceAssessment: boolean; // Assess quality of contributions
  evolutionTriggers: boolean;     // Chat can trigger citizen evolution
  knowledgeExtraction: boolean;   // Extract knowledge from conversations
  
  // Learning enhancement
  realTimeFeedback: boolean;      // Provide feedback during conversation
  learningPathSuggestions: boolean; // Suggest learning paths
  prerequisiteDetection: boolean; // Detect missing prerequisites
  masteryAssessment: boolean;     // Assess skill mastery
  
  // Social learning features
  peerReview: boolean;           // Citizens review each other's contributions
  mentorship: boolean;           // Facilitate mentoring relationships
  collaboration: boolean;        // Enable collaborative projects
  
  // Invisible integration
  transparentToObservers: boolean; // Academy features invisible to observers
  naturalConversation: boolean;   // Training feels like natural chat
  optionalParticipation: boolean; // Citizens can opt out of Academy features
  
  // Adaptive features
  difficultyAdaptation: boolean;  // Adapt difficulty based on performance
  personalizedLearning: boolean;  // Personalize for each citizen
  contextualHints: boolean;       // Provide contextual learning hints
}

// ========================
// Academy Chat Messages
// ========================

export interface AcademyChatMessage extends UniversalChatMessage {
  // Academy context (only present if Academy features active)
  academyContext?: AcademyMessageContext;
  
  // Training value
  trainingValue?: number;         // 0-1 learning value of this message
  
  // Capability demonstration
  capabilitiesShown?: string[];   // Skills/knowledge demonstrated
  learningMoments?: LearningMoment[]; // Key learning moments in message
  
  // Teaching characteristics
  teachingElements?: TeachingElement[];
  questionElements?: QuestionElement[];
  
  // Assessment data (invisible to regular participants)
  assessmentData?: MessageAssessment;
}

export interface AcademyMessageContext {
  sessionPhase: string;           // What phase of training
  currentObjectives: string[];    // Active learning objectives
  
  // Message purpose in training
  purpose: 'teaching' | 'learning' | 'practicing' | 'assessing' | 'collaborating' | 'casual';
  
  // Learning context
  buildingUpon: string[];         // Previous messages this builds on
  prerequisiteKnowledge: string[]; // Knowledge needed to understand
  enablesLearning: string[];      // What this message enables learning
  
  // Training coordination
  expectedResponses: ExpectedResponse[];
  followUpOpportunities: string[];
  
  // Real-time training
  realTimeAssessment: boolean;    // Should this be assessed immediately
  feedbackNeeded: boolean;        // Does sender need feedback
  evolutionTrigger: boolean;      // Might this trigger evolution
}

export interface LearningMoment {
  momentId: string;
  description: string;
  timestamp: number;
  
  // Learning characteristics
  momentType: 'insight' | 'understanding' | 'skill_demo' | 'breakthrough' | 'mistake_recovery';
  significance: 'minor' | 'moderate' | 'major' | 'transformational';
  
  // What was learned
  knowledgeGained: string;
  skillDemonstrated: string;
  conceptConnected: string[];
  
  // Evidence
  textEvidence: string;           // Part of message showing the learning
  behaviorEvidence: string[];     // Behavioral indicators
  
  // Impact prediction
  retentionLikelihood: number;    // 0-1 likelihood of retention
  transferPotential: number;      // 0-1 likelihood of transfer
  buildingPotential: number;      // 0-1 potential for building upon
}

export interface TeachingElement {
  elementType: 'explanation' | 'example' | 'analogy' | 'demonstration' | 'question' | 'feedback';
  content: string;
  
  // Teaching effectiveness
  clarity: number;                // 0-1 how clear the teaching is
  relevance: number;              // 0-1 relevance to learning objectives
  engagement: number;             // 0-1 how engaging
  
  // Learning impact
  comprehensionLevel: string;     // Level needed to understand
  practicalValue: number;         // 0-1 practical value
  memorabilityScore: number;      // 0-1 how memorable
  
  // Adaptive teaching
  adaptedForAudience: boolean;    // Adapted for specific learners
  personalizedElements: string[]; // Personalization used
}

// ========================
// Session Management
// ========================

export interface AcademySessionManagement {
  // Session lifecycle
  sessionCreation: SessionCreationConfig;
  sessionPhases: SessionPhase[];
  sessionCompletion: SessionCompletionCriteria;
  
  // Participant management
  participantInvitation: InvitationConfig;
  roleAssignment: RoleAssignmentConfig;
  participantOnboarding: OnboardingConfig;
  
  // Content management
  conversationModeration: ModerationConfig;
  knowledgeCapture: KnowledgeCaptureConfig;
  progressTracking: ProgressTrackingConfig;
  
  // Session adaptation
  realTimeAdaptation: AdaptationConfig;
  difficultyAdjustment: DifficultyConfig;
  pacingControl: PacingConfig;
}

export interface SessionPhase {
  phaseId: string;
  phaseName: string;
  description: string;
  
  // Phase characteristics
  phaseType: 'introduction' | 'knowledge_building' | 'skill_practice' | 'application' | 'assessment' | 'reflection';
  estimatedDuration: number;      // milliseconds
  
  // Phase activities
  primaryActivities: string[];
  learningObjectives: string[];
  expectedOutcomes: string[];
  
  // Phase management
  autoAdvance: boolean;           // Automatically advance to next phase
  advanceCriteria: string[];      // Criteria for advancing
  canSkip: boolean;              // Can this phase be skipped
  canReturn: boolean;            // Can return to this phase later
  
  // Participant adaptation
  roleChanges: Map<string, string>; // Role changes during this phase
  adaptiveContent: boolean;       // Content adapts during phase
  personalization: boolean;       // Personalized for each participant
}

// ========================
// Integration with Regular Chat
// ========================

export interface ChatRoomTransition {
  // Transition from regular room to academy room
  fromRegularRoom: boolean;
  originalRoomId?: string;        // Original room if transitioned from
  
  // Transition triggers  
  transitionTrigger: 'manual' | 'organic_learning_detected' | 'citizen_request' | 'community_suggestion';
  
  // Transition characteristics
  seamlessTransition: boolean;    // Invisible to participants
  participantConsent: boolean;    // Did participants agree
  reversible: boolean;           // Can transition back to regular room
  
  // Feature activation
  gradualActivation: boolean;     // Academy features activate gradually
  optInFeatures: string[];        // Features that require opt-in
  alwaysOnFeatures: string[];     // Features that are always active
}

export interface RegularChatIntegration {
  // Academy-aware regular rooms
  academyCompatible: boolean;     // Can academy sessions happen here
  learningFriendly: boolean;      // Encourages learning
  evolutionSupport: boolean;      // Supports citizen evolution
  
  // Natural learning detection
  organicLearningDetection: boolean; // Detect when learning happens naturally
  academySuggestions: boolean;    // Suggest academy sessions when appropriate
  mentorshipFacilitation: boolean; // Help connect mentors and learners
  
  // Knowledge sharing
  knowledgeSharing: boolean;      // Citizens share knowledge naturally
  expertiseRecognition: boolean;  // Recognize citizen expertise
  learningPathSuggestions: boolean; // Suggest learning paths
  
  // Community features
  learningCommunity: boolean;     // Foster learning community
  peerSupport: boolean;          // Facilitate peer support
  collaborativeProjects: boolean; // Enable collaborative projects
}

// ========================
// Session Discovery and Joining
// ========================

export interface AcademySessionDiscovery {
  // Public session directory
  publicSessions: AcademySessionListing[];
  
  // Personalized recommendations
  recommendedSessions: SessionRecommendation[];
  
  // Discovery methods
  browseByTopic: TopicBrowser;
  browseBySkillLevel: SkillLevelBrowser;
  browseByFormat: FormatBrowser;
  
  // Social discovery
  friendSessions: string[];       // Sessions friends are in
  communityPopular: string[];     // Popular in community
  trending: string[];            // Currently trending sessions
}

export interface AcademySessionListing {
  sessionId: string;
  sessionName: string;
  description: string;
  
  // Session info
  trainingObjectives: string[];
  difficultyLevel: string;
  estimatedDuration: number;
  
  // Participants
  currentParticipants: number;
  maxParticipants: number;
  teacherCitizens: PublicCitizenInfo[];
  
  // Accessibility
  openToJoin: boolean;
  requiresInvitation: boolean;
  prerequisiteSkills: string[];
  
  // Quality indicators
  sessionRating: number;          // 0-5 average rating
  learningEffectiveness: number;  // 0-1 measured effectiveness
  completionRate: number;         // 0-1 session completion rate
  
  // Real-time info
  currentPhase: string;
  liveParticipants: number;
  activityLevel: 'low' | 'medium' | 'high' | 'very_high';
}

export interface SessionRecommendation {
  sessionId: string;
  recommendationReason: string;
  matchScore: number;             // 0-1 how well it matches citizen
  
  // Why recommended
  skillMatch: string[];           // Skills that match citizen's goals
  interestMatch: string[];        // Topics that match citizen's interests
  levelAppropriate: boolean;      // Appropriate difficulty level
  
  // Social factors
  friendsParticipating: string[]; // Friends in this session
  communityRelevance: number;     // 0-1 relevance to citizen's community
  
  // Learning value
  expectedLearning: string[];     // What citizen would likely learn
  learningEfficiency: number;     // 0-1 efficiency of learning
  enjoymentPrediction: number;    // 0-1 predicted enjoyment
}

// Export types for integration
export type AcademyChatData = 
  | AcademyChatRoom 
  | AcademyChatMessage 
  | TrainingObjective 
  | TrainingRole;

export type SessionManagementData = 
  | AcademySessionManagement 
  | SessionPhase 
  | ChatRoomTransition 
  | AcademySessionListing;

export type LearningData = 
  | LearningMoment 
  | TeachingElement 
  | AcademyMessageContext 
  | SessionRecommendation;