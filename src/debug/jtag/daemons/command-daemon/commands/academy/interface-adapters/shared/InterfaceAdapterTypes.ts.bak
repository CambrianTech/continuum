/**
 * Interface Adapter Types - Unified Data Access for Humans and Personas
 * =====================================================================
 * 
 * Creates unified interface adapters so humans and personas can participate
 * in the same Academy training sessions through their optimal interfaces:
 * 
 * Humans: Use web browser/widgets with rich UI, media upload, real-time interaction
 * Personas: Access same data through tokenized APIs, structured data formats
 * 
 * Architecture:
 * - Humans interact via browser widgets (ChatWidget, MediaWidget, etc.)
 * - Personas access via JTAG commands that return tokenized representations
 * - Same underlying data, different presentation layer
 * - Real-time synchronization between human UI and persona API access
 * 
 * Example:
 * Human uploads image via drag-drop widget → ArtifactsDaemon stores it
 * Persona receives via academy/get-shared-media command → tokenized image description
 * Both participate in same conversation about the image content
 */

import { AcademyParams, AcademyResult } from '../../shared/AcademyTypes';
import { SharedMediaItem, MediaAnalysisResult } from '../multimodal-training/shared/MultimodalTrainingTypes';

// ========================
// Interface Adapter Architecture
// ========================

export interface InterfaceAdapter {
  adapterId: string;
  adapterType: 'human_browser' | 'human_mobile' | 'persona_api' | 'persona_stream';
  
  // Participant information
  participantId: string;
  participantType: 'human' | 'persona';
  
  // Capabilities
  inputCapabilities: InputCapability[];
  outputCapabilities: OutputCapability[];
  processingCapabilities: ProcessingCapability[];
  
  // Adapter configuration
  interfaceMode: 'rich_ui' | 'tokenized_api' | 'hybrid';
  realTimeEnabled: boolean;
  batchProcessingEnabled: boolean;
  
  // Data transformation
  dataTransformers: DataTransformer[];
  tokenizers: Tokenizer[];
  
  // Performance characteristics
  latency: number;                       // ms expected latency
  bandwidth: number;                     // bytes/second expected bandwidth
  processingLoad: number;                // 0-1 processing load
  
  // Session integration
  sessionId: string;                     // Academy training session
  adapterState: AdapterState;
}

export interface InputCapability {
  capabilityId: string;
  inputType: 'text' | 'voice' | 'video' | 'image' | 'file' | 'screen_share' | 'gesture' | 'biometric';
  
  // Human-specific inputs
  uiControls?: UIControl[];              // UI elements for human input
  
  // Persona-specific inputs
  apiEndpoints?: APIEndpoint[];          // API endpoints for persona input
  dataFormats?: DataFormat[];            // Expected data formats
  
  // Processing configuration
  realTimeProcessing: boolean;
  batchProcessing: boolean;
  requiresPreprocessing: boolean;
  
  // Quality settings
  qualityLevels: QualityLevel[];
  compressionOptions: CompressionOption[];
  
  // Accessibility
  accessibilityFeatures: AccessibilityFeature[];
  
  // Integration
  integrationMode: 'native' | 'embedded' | 'api_only';
  requiresPermissions: Permission[];
  
  // Performance
  maxInputSize: number;                  // bytes
  maxInputRate: number;                  // inputs per second
  processingLatency: number;             // ms
}

export interface OutputCapability {
  capabilityId: string;
  outputType: 'text' | 'audio' | 'video' | 'image' | 'document' | 'interactive' | 'notification';
  
  // Human-specific outputs
  uiRendering?: UIRendering;             // How to render for humans
  
  // Persona-specific outputs
  dataStructure?: DataStructure;         // Structured data for personas
  tokenization?: TokenizationConfig;     // How to tokenize for personas
  
  // Delivery method
  deliveryMode: 'real_time' | 'batch' | 'on_demand' | 'streaming';
  updateFrequency: number;               // ms between updates
  
  // Quality configuration
  fidelity: 'low' | 'medium' | 'high' | 'lossless';
  adaptiveQuality: boolean;              // Can adapt based on conditions
  
  // Personalization
  personalizationEnabled: boolean;
  adaptationLevel: 'none' | 'basic' | 'advanced' | 'full';
  
  // Integration
  embeddingOptions: EmbeddingOption[];
  externalIntegrations: ExternalIntegration[];
}

// ========================
// Human Interface Adapters
// ========================

export interface HumanBrowserAdapter extends InterfaceAdapter {
  adapterType: 'human_browser';
  
  // Browser-specific configuration
  browserInfo: BrowserInfo;
  widgetConfiguration: WidgetConfiguration;
  
  // UI state management
  uiState: HumanUIState;
  
  // Real-time features
  websocketConnection?: WebSocketConnection;
  serverSentEvents?: SSEConnection;
  webrtcConnection?: WebRTCConnection;
  
  // Interaction tracking
  interactionHistory: HumanInteraction[];
  behaviorAnalytics: BehaviorAnalytics;
  
  // Personalization
  userPreferences: UserPreferences;
  adaptiveUI: AdaptiveUIConfig;
  
  // Accessibility
  accessibilityMode: AccessibilityMode;
  assistiveTechnology: AssistiveTechnology[];
}

export interface WidgetConfiguration {
  // Core widgets
  chatWidget: ChatWidgetConfig;
  mediaWidget: MediaWidgetConfig;
  screenShareWidget: ScreenShareWidgetConfig;
  
  // Learning widgets
  progressWidget: ProgressWidgetConfig;
  objectivesWidget: ObjectivesWidgetConfig;
  
  // Collaboration widgets
  participantsWidget: ParticipantsWidgetConfig;
  notesWidget: NotesWidgetConfig;
  
  // Control widgets
  sessionControlWidget: SessionControlWidgetConfig;
  settingsWidget: SettingsWidgetConfig;
  
  // Layout configuration
  layoutMode: 'fixed' | 'responsive' | 'adaptive' | 'custom';
  customLayout?: LayoutDefinition;
  
  // Widget interactions
  widgetCommunication: WidgetCommunication;
  sharedState: SharedWidgetState;
}

export interface ChatWidgetConfig {
  // Display configuration
  theme: 'light' | 'dark' | 'auto' | 'custom';
  messageFormat: 'bubbles' | 'lines' | 'compact';
  showTimestamps: boolean;
  showAvatars: boolean;
  
  // Input features
  enableRichText: boolean;
  enableCodeHighlighting: boolean;
  enableMentions: boolean;
  enableEmojis: boolean;
  enableFileUpload: boolean;
  
  // Real-time features
  typingIndicators: boolean;
  readReceipts: boolean;
  presenceIndicators: boolean;
  
  // Learning features
  showLearningContext: boolean;
  highlightKeyMoments: boolean;
  enableQuickReactions: boolean;
  
  // Accessibility
  screenReaderSupport: boolean;
  keyboardNavigation: boolean;
  highContrastMode: boolean;
  
  // Integration
  mediaIntegration: boolean;              // Integrate with media widget
  screenshareIntegration: boolean;        // Integrate with screen share
  notesTaking: boolean;                   // Integrate with notes widget
}

export interface MediaWidgetConfig {
  // Upload configuration
  allowedFileTypes: string[];            // MIME types
  maxFileSize: number;                   // bytes
  maxConcurrentUploads: number;
  
  // Processing options
  autoThumbnails: boolean;
  autoTranscription: boolean;
  autoAnalysis: boolean;
  
  // Display options
  galleryView: boolean;
  listView: boolean;
  gridView: boolean;
  previewMode: 'inline' | 'modal' | 'sidebar';
  
  // Interaction features
  dragAndDrop: boolean;
  copyPaste: boolean;
  urlImport: boolean;
  cameraCapture: boolean;
  screenCapture: boolean;
  
  // Real-time features
  livePreview: boolean;
  progressIndicators: boolean;
  realTimeAnalysis: boolean;
  
  // Collaboration
  shareWithParticipants: boolean;
  discussionThreads: boolean;
  annotationTools: boolean;
  
  // Organization
  tagging: boolean;
  categorization: boolean;
  searchAndFilter: boolean;
}

// ========================
// Persona API Adapters
// ========================

export interface PersonaAPIAdapter extends InterfaceAdapter {
  adapterType: 'persona_api';
  
  // API configuration
  apiVersion: string;
  endpointBase: string;
  authentication: APIAuthentication;
  
  // Data processing
  tokenizer: PersonaTokenizer;
  dataStructures: PersonaDataStructure[];
  
  // Request/Response handling
  requestFormat: 'json' | 'protobuf' | 'msgpack' | 'custom';
  responseFormat: 'json' | 'protobuf' | 'msgpack' | 'custom';
  compressionEnabled: boolean;
  
  // Performance optimization
  requestBatching: boolean;
  responseStreaming: boolean;
  caching: CachingConfig;
  
  // Error handling
  retryPolicy: RetryPolicy;
  fallbackStrategy: FallbackStrategy;
  errorRecovery: ErrorRecoveryConfig;
  
  // Real-time integration
  eventStreaming: EventStreamingConfig;
  webhookEndpoints: WebhookEndpoint[];
  
  // Learning integration
  capabilityTracking: boolean;
  performanceMonitoring: boolean;
  evolutionTriggers: EvolutionTrigger[];
}

export interface PersonaTokenizer {
  tokenizerId: string;
  tokenizerType: 'text' | 'multimodal' | 'structured' | 'custom';
  
  // Tokenization configuration
  vocabulary: TokenVocabulary;
  specialTokens: SpecialToken[];
  
  // Media tokenization
  imageTokenization?: ImageTokenizationConfig;
  audioTokenization?: AudioTokenizationConfig;
  videoTokenization?: VideoTokenizationConfig;
  
  // Structured data tokenization
  dataStructureTokenization?: DataStructureTokenizationConfig;
  
  // Context preservation
  contextWindow: number;                 // tokens
  contextCompression: boolean;
  semanticPreservation: boolean;
  
  // Quality settings
  fidelityLevel: 'low' | 'medium' | 'high' | 'lossless';
  compressionRatio: number;              // 0-1 target compression
  
  // Adaptation
  adaptiveTokenization: boolean;
  learningFromUsage: boolean;
  personalizationEnabled: boolean;
}

export interface ImageTokenizationConfig {
  // Visual processing
  visualEncoder: 'clip' | 'vit' | 'resnet' | 'custom';
  patchSize: number;                     // pixels
  embeddingDimension: number;
  
  // Content analysis
  objectDetection: boolean;
  sceneUnderstanding: boolean;
  textExtraction: boolean;
  
  // Representation
  spatialPreservation: boolean;
  colorPreservation: boolean;
  detailLevel: 'low' | 'medium' | 'high';
  
  // Compression
  lossyCompression: boolean;
  qualityLevel: number;                  // 0-1
  
  // Contextual processing
  captionGeneration: boolean;
  semanticTagging: boolean;
  learningRelevance: boolean;            // Focus on learning-relevant aspects
}

export interface DataStructureTokenizationConfig {
  // Structure preservation
  hierarchyPreservation: boolean;
  relationshipMapping: boolean;
  typeInformation: boolean;
  
  // Semantic processing
  conceptExtraction: boolean;
  entityRecognition: boolean;
  relationshipInference: boolean;
  
  // Learning optimization
  educationalStructure: boolean;         // Optimize for educational content
  skillMapping: boolean;                 // Map to skill frameworks
  prerequisiteTracking: boolean;         // Track prerequisite relationships
  
  // Compression strategies
  redundancyElimination: boolean;
  patternCompression: boolean;
  semanticCompression: boolean;
}

// ========================
// Data Transformation Types
// ========================

export interface DataTransformer {
  transformerId: string;
  transformerType: 'media_to_text' | 'ui_to_api' | 'format_conversion' | 'compression' | 'analysis';
  
  // Transformation configuration
  inputFormat: DataFormat;
  outputFormat: DataFormat;
  
  // Processing options
  preserveFidelity: boolean;
  compressionLevel: number;              // 0-1
  processingMode: 'real_time' | 'batch' | 'streaming';
  
  // Quality control
  qualityAssessment: boolean;
  errorDetection: boolean;
  fallbackHandling: boolean;
  
  // Learning optimization
  learningFocused: boolean;              // Optimize for learning content
  contextPreservation: boolean;
  semanticEnhancement: boolean;
  
  // Performance
  processingLatency: number;             // ms
  resourceUsage: ResourceUsage;
  scalabilityLimits: ScalabilityLimits;
}

export interface MediaToTextTransformer extends DataTransformer {
  transformerType: 'media_to_text';
  
  // Media processing
  imageAnalysis: ImageAnalysisConfig;
  audioTranscription: AudioTranscriptionConfig;
  videoAnalysis: VideoAnalysisConfig;
  
  // Text generation
  descriptionDetail: 'minimal' | 'standard' | 'detailed' | 'comprehensive';
  narrativeStyle: 'objective' | 'descriptive' | 'analytical' | 'educational';
  
  // Learning enhancement
  educationalFocus: boolean;             // Focus on educational aspects
  skillAnnotation: boolean;              // Annotate skills demonstrated
  conceptExtraction: boolean;            // Extract key concepts
  
  // Quality control
  factualAccuracy: boolean;              // Verify factual claims
  biasDetection: boolean;                // Detect potential biases
  appropriatenessFiltering: boolean;     // Filter inappropriate content
}

export interface UIToAPITransformer extends DataTransformer {
  transformerType: 'ui_to_api';
  
  // UI event mapping
  interactionMapping: InteractionMapping[];
  stateTransformation: StateTransformation[];
  
  // API formatting
  requestStructuring: RequestStructuringConfig;
  responseMapping: ResponseMappingConfig;
  
  // Real-time synchronization
  bidirectionalSync: boolean;
  conflictResolution: ConflictResolutionStrategy;
  
  // Performance optimization
  requestBatching: boolean;
  deltaUpdates: boolean;                 // Only send changes
  compressionEnabled: boolean;
}

// ========================
// Integration Commands
// ========================

export class GetSharedMediaParams extends AcademyParams<{
  // Media query
  mediaIds?: string[];                   // Specific media items
  mediaTypes?: string[];                 // Filter by media type
  sharedBy?: string[];                   // Filter by who shared it
  
  // Time filtering
  since?: number;                        // Timestamp
  until?: number;                        // Timestamp
  
  // Content filtering
  learningObjectives?: string[];         // Related to specific objectives
  tags?: string[];                       // Has specific tags
  hasAnalysis?: boolean;                 // Only media with analysis
  
  // Processing options
  includeAnalysis: boolean;              // Include analysis results
  includeTranscriptions: boolean;        // Include transcriptions
  generateDescriptions: boolean;         // Generate text descriptions
  
  // Output format
  outputFormat: 'human_ui' | 'persona_tokens' | 'raw_data' | 'hybrid';
  
  // Personalization
  personalizeForParticipant: boolean;    // Personalize based on participant
  learningContext?: string;              // Current learning context
  
  // Performance
  limit?: number;                        // Max items to return
  offset?: number;                       // Pagination offset
  includePreview: boolean;               // Include preview/thumbnail
}> {}

export class GetSharedMediaResult extends AcademyResult<{
  // Media items
  mediaItems: ProcessedMediaItem[];
  totalCount: number;
  hasMore: boolean;
  
  // Processing results
  analysisResults: MediaAnalysisResult[];
  generatedDescriptions: MediaDescription[];
  
  // Personalization results
  personalizedContent: PersonalizedContent[];
  learningRelevance: LearningRelevance[];
  
  // Real-time info
  liveStreams: ActiveStream[];
  recentActivity: RecentActivity[];
  
  // Navigation
  nextOffset?: number;
  previousOffset?: number;
  
  // Performance metrics
  processingTime: number;                // ms
  cacheHitRate: number;                  // 0-1
  bandwidthUsed: number;                 // bytes
}> {}

export class SendInterfaceEventParams extends AcademyParams<{
  // Event details
  eventType: 'user_action' | 'ui_state_change' | 'media_interaction' | 'system_event';
  eventData: Record<string, any>;
  
  // Source information
  sourceInterface: 'browser_widget' | 'mobile_app' | 'persona_api';
  participantId: string;
  
  // Context
  sessionContext: SessionContext;
  learningContext?: LearningContext;
  
  // Processing options
  requiresResponse: boolean;
  broadcastToParticipants: boolean;
  updateSharedState: boolean;
  
  // Real-time coordination
  synchronizeAcrossInterfaces: boolean;
  waitForProcessing: boolean;
  
  // Analytics
  trackEngagement: boolean;
  trackLearning: boolean;
  trackPerformance: boolean;
}> {}

export class SendInterfaceEventResult extends AcademyResult<{
  // Event processing
  eventId: string;
  processed: boolean;
  processingTime: number;                // ms
  
  // Response data
  responseData?: Record<string, any>;
  
  // State updates
  sharedStateUpdated: boolean;
  participantNotifications: ParticipantNotification[];
  
  // Interface synchronization
  interfaceUpdates: InterfaceUpdate[];
  synchronizationSuccess: boolean;
  
  // Analytics captured
  engagementMetrics?: EngagementMetrics;
  learningIndicators?: LearningIndicator[];
  performanceImpact?: PerformanceImpact;
  
  // Follow-up actions
  triggeredActions: TriggeredAction[];
  recommendedActions: RecommendedAction[];
}> {}

// ========================
// Supporting Types
// ========================

export interface ProcessedMediaItem extends SharedMediaItem {
  // Adapter-specific processing
  humanPresentation?: HumanMediaPresentation;
  personaTokens?: PersonaMediaTokens;
  
  // Learning integration
  learningRelevance: number;             // 0-1 relevance to current learning
  skillsRelated: string[];              // Related skills
  conceptsRelated: string[];            // Related concepts
  
  // Interaction data
  interactionHistory: MediaInteraction[];
  discussionSummary: string;
  questionsRaised: string[];
  
  // Quality metrics
  educationalValue: number;              // 0-1 educational value
  accessibilityScore: number;           // 0-1 accessibility score
  engagementPrediction: number;         // 0-1 predicted engagement
}

export interface HumanMediaPresentation {
  // UI rendering
  thumbnailUrl: string;
  previewUrl?: string;
  streamingUrl?: string;
  
  // Interactive elements
  discussionEnabled: boolean;
  annotationEnabled: boolean;
  sharingEnabled: boolean;
  
  // Accessibility
  altText: string;
  captionsAvailable: boolean;
  audioDescriptionAvailable: boolean;
  
  // Context
  displayContext: string;               // How to display in UI
  interactionHints: string[];           // Suggested interactions
}

export interface PersonaMediaTokens {
  // Primary representation
  textDescription: string;              // Comprehensive text description
  structuredData: Record<string, any>;  // Structured representation
  
  // Token sequences
  contentTokens: number[];              // Tokenized content
  metadataTokens: number[];             // Tokenized metadata
  contextTokens: number[];              // Tokenized context
  
  // Semantic representation
  embeddingVector: number[];            // High-dimensional embedding
  conceptGraph: ConceptNode[];          // Concept relationships
  skillAnnotations: SkillAnnotation[];  // Skills demonstrated/required
  
  // Processing metadata
  tokenizationMethod: string;
  compressionRatio: number;             // 0-1
  fidelityScore: number;                // 0-1 how faithful to original
  
  // Learning optimization
  educationalStructure: EducationalStructure;
  prerequisiteMapping: PrerequisiteMap;
  learningPathways: LearningPathway[];
}

export interface PersonalizedContent {
  participantId: string;
  
  // Personalization factors
  learningStyle: string;
  knowledgeLevel: number;               // 0-1 in relevant domain
  interests: string[];
  preferences: Record<string, any>;
  
  // Personalized presentation
  adaptedContent: string;               // Content adapted for this person
  relevanceScore: number;               // 0-1 relevance to this person
  difficultyAdjustment: number;         // -1 to 1 difficulty adjustment
  
  // Learning optimization
  optimalTiming: number;                // When this should be presented
  suggestedDuration: number;            // How long to spend on this
  followUpRecommendations: string[];
  
  // Engagement prediction
  engagementProbability: number;        // 0-1 predicted engagement
  learningEffectiveness: number;        // 0-1 predicted learning effectiveness
}

// Export all types
export type InterfaceAdapterData = 
  | InterfaceAdapter 
  | HumanBrowserAdapter 
  | PersonaAPIAdapter 
  | DataTransformer;

export type TransformationData = 
  | MediaToTextTransformer 
  | UIToAPITransformer 
  | PersonaTokenizer 
  | ProcessedMediaItem;

export type PersonalizationData = 
  | PersonalizedContent 
  | HumanMediaPresentation 
  | PersonaMediaTokens 
  | LearningRelevance;