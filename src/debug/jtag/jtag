#!/bin/bash
# JTAG Terminal Portal - Ensures system is running and connects CLI

# Check for --restart flag
RESTART_FLAG=""
if [[ "$*" == *"--restart"* ]]; then
  echo "ðŸ”„ Restart requested, launching npm start..."
  npm start &
  RESTART_FLAG="--restart"
else
  # Check if ports 9001 and 9002 are in use
  PORT_9001=$(lsof -ti:9001 2>/dev/null)
  PORT_9002=$(lsof -ti:9002 2>/dev/null)
  
  if [[ -z "$PORT_9001" || -z "$PORT_9002" ]]; then
    echo "ðŸš€ JTAG system not running, starting with npm start..."
    npm start &
  else
    echo "âœ… JTAG system detected running (ports 9001: $PORT_9001, 9002: $PORT_9002)"
  fi
fi

# Forward all args to CLI (we need to create this file)
npx tsx cli.ts "$@"