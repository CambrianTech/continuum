/**
 * Shared Types for Script Architecture
 * 
 * Common interfaces and types used across all configuration and automation scripts.
 * Promotes consistency and reduces duplication across the script ecosystem.
 */

// ============================================================================
// Core Configuration Types
// ============================================================================

export interface PathMapping {
  alias: string;
  relativePath: string;
  description: string;
  autoGenerated: boolean;
}

export interface UnifiedConfig {
  projectName: string;
  version: string;
  pathMappings: { [key: string]: PathMapping };
  structureGeneration: StructureGenerationConfig;
  generatedAt: string;
  description: string;
}

export interface StructureGenerationConfig {
  directories: { [key: string]: StructureDirectoryConfig };
}

export interface StructureDirectoryConfig {
  outputFile: string;
  environment: string;
  daemonPaths?: string[];
  commandPaths?: string[];
  excludePatterns: string[];
}

// ============================================================================
// Processing Statistics
// ============================================================================

export interface ProcessingStats {
  filesProcessed: number;
  filesModified: number;
  totalReplacements: number;
  startTime?: Date;
  endTime?: Date;
  duration?: number;
}

export interface FileProcessingResult {
  filePath: string;
  modified: boolean;
  replacements: number;
  errors?: string[];
}

// ============================================================================
// File System Types
// ============================================================================

export interface FileDiscoveryOptions {
  extensions: string[];
  excludedDirs: string[];
  excludedPatterns: string[];
  includeHidden: boolean;
}

export interface DirectoryTraversalResult {
  files: string[];
  directories: string[];
  errors: string[];
}

// ============================================================================
// Replacement & Transformation Types
// ============================================================================

export interface ReplacementRule {
  pattern: RegExp;
  replacement: string | ((match: string, ...groups: string[]) => string);
  description: string;
}

export interface TransformationResult {
  originalContent: string;
  transformedContent: string;
  replacements: ReplacementOperation[];
  success: boolean;
  errors: string[];
}

export interface ReplacementOperation {
  type: 'path-alias' | 'import-fix' | 'config-update' | 'structure-gen';
  originalValue: string;
  newValue: string;
  lineNumber?: number;
  column?: number;
  confidence: 'high' | 'medium' | 'low';
}

// ============================================================================
// Configuration Generation Types
// ============================================================================

export interface ConfigGenerationOptions {
  enableDuplicateDetection: boolean;
  enablePathOptimization: boolean;
  enableBackupGeneration: boolean;
  verboseLogging: boolean;
}

export interface ConfigOutput {
  filename: string;
  content: string;
  mappingCount: number;
  generatedAt: Date;
}

// ============================================================================
// Error Handling Types
// ============================================================================

export interface ScriptError {
  type: 'configuration' | 'file-system' | 'processing' | 'validation';
  message: string;
  file?: string;
  line?: number;
  details?: any;
  timestamp: Date;
}

export interface ValidationResult {
  valid: boolean;
  errors: ScriptError[];
  warnings: string[];
  suggestions: string[];
}

// ============================================================================
// Logging & Output Types
// ============================================================================

export type LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'success';

export interface LogEntry {
  level: LogLevel;
  message: string;
  timestamp: Date;
  context?: string;
  metadata?: any;
}

export interface ProgressReport {
  stage: string;
  completed: number;
  total: number;
  percentage: number;
  estimatedTimeRemaining?: number;
}

// ============================================================================
// Script Configuration
// ============================================================================

export interface ScriptConfig {
  rootPath: string;
  dryRun: boolean;
  verbose: boolean;
  backup: boolean;
  parallel: boolean;
  maxConcurrency: number;
}

// ============================================================================
// Type Guards & Utilities
// ============================================================================

export const isPathMapping = (obj: any): obj is PathMapping => {
  return obj && 
         typeof obj.alias === 'string' &&
         typeof obj.relativePath === 'string' &&
         typeof obj.description === 'string' &&
         typeof obj.autoGenerated === 'boolean';
};

export const isUnifiedConfig = (obj: any): obj is UnifiedConfig => {
  return obj && 
         typeof obj.projectName === 'string' &&
         typeof obj.version === 'string' &&
         obj.pathMappings &&
         typeof obj.pathMappings === 'object';
};

export const isProcessingStats = (obj: any): obj is ProcessingStats => {
  return obj &&
         typeof obj.filesProcessed === 'number' &&
         typeof obj.filesModified === 'number' &&
         typeof obj.totalReplacements === 'number';
};